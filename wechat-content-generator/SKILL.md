# 微信公众号内容生成器 v4.1（场景化工作流）

**版本**：v4.1
**更新日期**：2026-01-30
**重大变更**：增加场景识别，区分新建和编辑流程

---

## 🔍 场景识别（强制执行）

**在执行任何操作前，必须先识别场景类型**：

### 场景A：新建内容（完整工作流）

**触发词**：
- "生成"、"创建"、"写一篇"
- "帮我生成XX"、"创建一篇XX"

**执行流程**：
- Step 0-8 完整工作流
- 包括：苏格拉底式提问、去重检查、选题确定等

---

### 场景B：编辑内容（简化工作流）

**触发词**：
- "修改"、"调整"、"改一下"
- "优化"、"重写"、"完善"

**执行流程**：
```
Step 0: 识别为编辑场景
Step 1: 读取已有内容
Step 2: 询问修改需求（简化提问）
Step 3: 执行修改
Step 4: 质量检查（必须遵循所有规范）
Step 5: 保存
Step 6: 询问是否重新推送
```

**⚠️ 重要**：
- 虽然是简化流程，但**必须遵循所有 Skill 规范**
- 包括：内容质量标准、配图规范、违禁词检查、账号阶段策略等
- 不能因为是"修改"就降低质量要求

---

## 🚨 执行协议

### 新建内容场景（两阶段）

**阶段1：交互式收集信息**
- ✅ **必须** 先进行苏格拉底式提问
- ✅ **必须** 检查已发布内容（去重）
- ✅ **必须** 根据账号阶段决定商品植入策略

**阶段2：静默执行生成**
- ❌ **禁止** 请求确认以继续
- ✅ **必须** 一次性生成完整输出（文案 + 配图 + 推送）
- ✅ **必须** 自动进行违禁词检查

---

### 编辑内容场景（简化但严格）

**简化的部分**：
- ❌ 不需要苏格拉底式提问（已有内容）
- ❌ 不需要去重检查（已有内容）
- ❌ 不需要选题确定（已有选题）

**必须遵循的规范**：
- ✅ 内容质量标准（标题、摘要、正文结构）
- ✅ 配图规范（尺寸、数量、风格）
- ✅ 违禁词检查
- ✅ 账号阶段策略（商品植入度）
- ✅ 保存和推送规范
- ✅ 信任型内容原则

---

## 📋 核心功能

1. 搜索/加载知识文档
2. 匹配相关商品（从商品库智能匹配1-3个）
3. 生成内容（标题 + 摘要 + 正文 + CTA）
4. 生成配图（根据格式选择比例）
5. 保存文件到专属文件夹
6. 推送至微信公众号草稿箱

---

## 🆕 [必需] 内容格式参数

### 两种格式对照

| 格式 | 触发词 | 配图比例 | 配图数量 |
|-----|-------|---------|---------|
| **长文** | \"公众号长文\"、\"订阅号长文\" | 横版（封面2.35:1，正文16:9） | 1封面+3正文 |
| **图文** | \"公众号图文\"、\"订阅号图文\" | 竖版（3:4，1080×1440） | 1封面+5正文 |

**默认**：未指定时默认生成长文（横版）

---

## 📚 [必需] 订阅号图文格式库

**当用户说\"订阅号图文\"时，必须询问格式：**

1. **诗意金句治愈哲理** - 现代小诗体，触动人心
2. **实用干货体** - 结构化知识点，清晰实用
3. **故事叙事体** - 情节化叙述，画面感强
4. **问答互动体** - 问答结构，对话感强

**详细格式说明**：参考 `knowledge/subscription-copywriting.md`

---

## 🎯 [必需] 双号运营策略

### 订阅号 vs 服务号定位

| 维度 | 订阅号 | 服务号 |
|------|--------|--------|
| **内容类型** | 干货知识、情感共鸣 | 产品介绍、服务说明 |
| **商品植入** | 软植入（1-2段） | 可直接推荐（2-3段） |
| **CTA** | 引导关注、评论 | 引导购买、咨询 |

**详细策略**：参考 `knowledge/wechat_strategy_handbook.md`

---

## 🖼️ [必需] 配图规范

### 核心要求

**长文格式**：
- 封面：2.35:1（900×383px）
- 正文：16:9（900×506px）
- 数量：1封面 + 3正文

**图文格式**：
- 封面：3:4（1080×1440px）
- 正文：3:4（1080×1440px）
- 数量：1封面 + 5正文

### 配图风格规则

**封面图**：按照通篇文档的风格选择
**正文配图**：按照对应段落内容选择风格

**详细指南**：参考 `knowledge/wechat-image-prompt-guide.md`

---

## 🔄 执行流程

### 流程选择

**根据场景识别结果，选择对应的执行流程**：
- 场景A（新建内容） → 执行流程A（Step 0-8）
- 场景B（编辑内容） → 执行流程B（Step E0-E6）

---

## 📝 流程A：新建内容（完整工作流）

### Step 0: 苏格拉底式提问 [强制]

**⚠️ 重要**：这是开放式对话，不是固定选项。用户可以自由描述，AI 要智能理解。

**询问内容**：
1. 内容格式（长文/图文）
2. 平台类型（订阅号/服务号）
3. 内容目的（涨粉/互动/专业形象/其他）
4. 选题方向（指定选题/大致方向/AI推荐）
5. 内容深度（基础/进阶/专业/创新角度）
6. 商品植入（是/否/极少）

**详细指南**：参考 `_global_config/intelligent-topic-selection-guide.md`

---

### Step 1: 检查已发布内容 [强制]

**目的**：避免选题和角度重复

**操作**：
1. 读取 `/Users/dj/Desktop/全域自媒体运营/内容发布/发布记录/2026/订阅号/` 目录
2. 列出最近30天的已发布内容标题和主题
3. 分析：哪些话题已经写过？哪些角度已经用过？
4. **强制要求**：新选题必须与已发布内容有明显差异

**输出示例**：
```
已发布内容分析（最近30天）：
- 蝴蝶兰养护：已发布3篇（浇水、黄叶、烂根）
- 仙客来养护：已发布2篇（温度、浇水）
- 年宵花选购：已发布1篇

建议避开：蝴蝶兰、仙客来、年宵花的常规养护话题
建议方向：其他植物品种、春季换盆、病虫害防治等
```

---

### Step 2: 确定选题 [强制]

**核心原则**：
- ❌ 不要局限于常见植物
- ❌ 不要局限于基础养护
- ✅ 要有深度、创新、专业性
- ✅ 新手内容可以讲，但要换角度

**详细指南**：参考 `_global_config/intelligent-topic-selection-guide.md`

---

### Step 3: 知识搜索 [必需，静默执行]

**从此步骤开始，进入静默执行模式，不再请求确认**

**要求**：
- 搜索专业、深度、创新的内容
- 不要只搜索基础养护知识
- 要有科学依据、专业术语

**详细指南**：参考 `_global_config/intelligent-topic-selection-guide.md`

- 使用 WebSearch 搜索相关知识
- 搜索本地知识库
- 整合网络和本地知识

---

### Step 4: 商品匹配 [条件执行，静默执行]

**执行条件**：
- 用户在 Step 0 中明确要求商品植入
- 或内容目的是"推销商品"

**根据账号阶段执行不同策略**：

**起号期（0-500粉）**：
- ✅ 执行商品匹配（了解有哪些相关商品）
- ✅ 仅作案例提及（如："我自己用的是XX"）
- ❌ 禁止价格
- ❌ 禁止直接推荐
- ⚠️ 商品不主导内容方向，内容价值优先

**成长期（500-2000粉）**：
- ✅ 执行商品匹配
- ✅ 软植入（1-2段自然提及）
- ✅ 评论区引导
- ✅ 可以提价格（客观对比）
- ⚠️ 内容比例：80%价值 + 20%引导

**成熟期（2000+粉）**：
- ✅ 执行商品匹配
- ✅ 可挂链接
- ✅ 可说价格
- ✅ 可直接推荐
- ⚠️ 内容比例：70%价值 + 30%转化

---

### Step 5: 生成内容 [必需，静默执行]
- 生成标题、摘要、正文
- 根据平台类型和账号阶段调整商品植入度
- 生成 CTA

---

### Step 5.5: 价值自检 [强制，不能跳过] ⚠️

**⚠️ 这是最关键的步骤，决定内容是否有价值**

**必须回答以下6个问题并输出**：

1. **目标读者是谁？**（具体描述）
2. **读者有什么问题/痛点？**（具体问题）
3. **这个内容能解决什么问题？**（具体方案）
4. **读者看完后能得到什么？**（可执行收获）
5. **为什么读者应该相信你？**（可信度支撑）
6. **这个内容的独特价值是什么？**（差异化）

**如果有任何一个问题答不上来 → 停止生成，重新思考选题**

**详细指南**：参考 `_global_config/content-value-checklist.md`

---

### Step 6: 生成配图 [必需，静默执行]
- 根据格式选择配图比例
- 封面按通篇风格，正文按段落内容
- 调用 generate_wechat_images.py

---

### Step 7: 保存文件 [必需，静默执行]
- 创建专属文件夹
- 保存 Markdown 文档
- 保存所有配图

---

### Step 8: 推送草稿箱 [必需，静默执行]
- 调用 wechat_publish.py
- 推送至微信公众号草稿箱

---

**检查点**：
- [ ] 已完成苏格拉底式提问
- [ ] 已检查已发布内容（去重）
- [ ] 已确定选题（与已发布内容有差异）
- [ ] 已执行知识搜索
- [ ] 已根据条件决定是否商品匹配
- [ ] 已生成配图
- [ ] 已推送草稿箱

---

## 📦 输出结构

```
/Users/dj/Desktop/全域自媒体运营/内容发布/发布记录/2026/订阅号/
└── 2026-01-29_选题名称/
    ├── 2026-01-29_选题名称.md
    ├── cover.png
    ├── 01.png, 02.png, 03.png
    └── data.json
```

---

## ✏️ 流程B：编辑内容（简化但严格工作流）

### Step E0: 场景识别和内容定位 [强制]

**操作**：
1. 识别用户意图（修改/优化/重写）
2. 确定要编辑的内容位置
3. 读取已有内容

**询问**：
- "请提供要编辑的内容路径或日期"
- 或"请描述要编辑的内容（如：昨天生成的订阅号文章）"

---

### Step E1: 读取已有内容 [强制]

**操作**：
1. 读取 Markdown 文档
2. 读取配图文件
3. 读取 data.json（如果存在）
4. 分析当前内容的：
   - 格式（长文/图文）
   - 平台类型（订阅号/服务号）
   - 账号阶段
   - 商品植入情况

---

### Step E2: 询问修改需求 [强制]

**使用 AskUserQuestion 工具询问**：

```
问题1：需要修改哪些部分？（可多选）
选项：
- 标题
- 摘要
- 正文内容
- 配图
- CTA
- 全部重写

问题2：修改的原因或目标是什么？
选项：
- 优化质量（提升可读性）
- 调整商品植入度
- 修正错误信息
- 适配不同平台
- 其他（请描述）
```

---

### Step E3: 执行修改 [必需，静默执行]

**根据修改需求执行对应操作**：

**如果修改标题**：
- 遵循标题规范（≤25字）
- 保持吸引力和信息性
- 符合平台调性

**如果修改正文**：
- 保持原有结构（除非要求重构）
- 遵循信任型内容原则
- 确保逻辑连贯

**如果修改配图**：
- 遵循配图规范（尺寸、数量、风格）
- 调用 `generate_wechat_images.py`
- 确保与内容匹配

**如果调整商品植入**：
- 根据账号阶段执行对应策略
- 起号期：仅作案例提及，禁止价格
- 成长期：软植入，可提价格
- 成熟期：可挂链接，可说价格

**如果全部重写**：
- 保留原有选题方向
- 重新生成内容
- 遵循所有 Skill 规范

---

### Step E4: 质量检查 [强制，静默执行]

**必须执行以下检查**（不能因为是"修改"就跳过）：

1. **违禁词检查**
   - 调用 `compliance-checker`
   - 确保无违禁词、夸张用语

2. **配图规范检查**
   - 长文：1封面（2.35:1）+ 3正文（16:9）
   - 图文：1封面（3:4）+ 5正文（3:4）
   - 确保尺寸、数量、风格符合要求

3. **内容质量检查**
   - 标题 ≤25字
   - 摘要简洁有力
   - 正文结构清晰
   - CTA 完整

4. **账号阶段策略检查**
   - 商品植入度符合账号阶段
   - 起号期：禁止价格
   - 成长期/成熟期：按规范执行

5. **信任型内容原则检查**
   - 客观真实
   - 避免情绪化标题
   - 避免夸张绝对化

**如果发现问题**：
- 自动修正（如违禁词替换）
- 或提示用户需要调整

---

### Step E5: 保存文件 [必需，静默执行]

**操作**：
1. 保存修改后的 Markdown 文档
2. 保存新生成的配图（如果有）
3. 更新 data.json
4. 在文件名或 data.json 中标注"已修改"

**文件结构**：
```
/Users/dj/Desktop/全域自媒体运营/内容发布/发布记录/2026/订阅号/
└── 2026-01-30_选题名称/
    ├── 2026-01-30_选题名称.md（已更新）
    ├── cover.png（如果重新生成）
    ├── 01.png, 02.png, 03.png（如果重新生成）
    └── data.json（已更新，标注修改时间）
```

---

### Step E6: 询问是否重新推送 [必需]

**使用 AskUserQuestion 工具询问**：

```
问题：是否需要重新推送到微信公众号草稿箱？
选项：
- 是（立即推送）
- 否（仅保存本地）
- 稍后手动推送
```

**如果选择"是"**：
- 调用 `wechat_publish.py`
- 推送至草稿箱
- 输出推送结果

---

## 📋 编辑场景检查清单

**每次编辑内容时，必须确认**：

- [ ] 已识别为编辑场景
- [ ] 已读取已有内容
- [ ] 已询问修改需求
- [ ] 已执行修改
- [ ] **已进行质量检查（违禁词、配图、内容质量、账号阶段、信任型原则）**
- [ ] 已保存文件
- [ ] 已询问是否重新推送

**⚠️ 重点**：
- 编辑场景虽然简化了前期步骤，但**质量检查不能省略**
- 所有 Skill 规范都必须遵循
- 不能因为是"修改"就降低质量要求

---

## 📚 详细文档

- **格式库详细说明**：`knowledge/subscription-copywriting.md`
- **配图生成指南**：`knowledge/wechat-image-prompt-guide.md`
- **运营策略手册**：`knowledge/wechat_strategy_handbook.md`
- **CTA 模板库**：`knowledge/cta-templates.md`
- **商品植入指南**：`knowledge/service-product-linking.md`

---

## 🔧 依赖

- `product-catalog` (Skill) - 商品匹配
- `compliance-checker` (Skill) - 违禁词检查
- `WebSearch` - 知识搜索
- `scripts/generate_wechat_images.py` - 配图生成
- `scripts/wechat_publish.py` - 推送草稿箱

---

**版本历史**：
- v4.1 (2026-01-30): 增加场景识别，区分新建和编辑流程
- v4.0 (2026-01-30): 修正执行流程，采用苏格拉底式提问 + 去重检查
- v3.8 (2026-01-29): 按照四层机制精简 SKILL.md
- v3.7 (2026-01-23): 新增订阅号图文格式库
- v3.3 (2026-01-15): 新增内容格式参数
