---
name: illustration-converter
description: "将真实植物照片转换为多种艺术插画风格（水彩/国画/彩铅/油画/彩绘），所有风格都支持步骤图生成"
license: MIT
version: "1.4"
---

# 插画风格转换器 v1.4

## 📋 概述

将真实植物照片转换为艺术插画，支持5大风格类别（水彩/国画/彩铅/油画/彩绘），每种风格区分东方/西方美感。特别支持彩铅步骤图生成，适合教程类内容。

**核心价值**：
- 提升内容视觉多样性
- 真实照片 → 艺术插画，一键转换
- 保证同风格视觉一致性（固定模型选择）

---

## 🎯 核心功能

- **图片分析**：自动分析上传照片的构图、植物特征、色彩、光线
- **风格转换**：5大风格 × 2种美感 = 10种插画风格
- **步骤图生成**：彩铅风格支持4-6步分步骤教程图
- **智能推荐**：基于图片特征推荐最适合的风格
- **模型固定**：每种风格固定使用最佳模型，保证视觉一致性

---

## ⚠️ 执行检查清单（强制）

**在执行 Skill 时，必须完成以下所有步骤，不得跳过：**

- [ ] Step 0: 输入识别（图片分析或文字描述）
- [ ] Step 1: 交互式提问（风格、美感、特殊要求）
- [ ] Step 2: 模型选择（自动）
- [ ] Step 3: Prompt 构建（自动）
- [ ] Step 4: 系列图片生成（4张）
- [ ] Step 5: 生成小红书标题和标签
- [ ] Step 6: 保存输出
- [ ] **Step 7: 满意度评级（强制，不能跳过）** ⚠️

**重要提醒**：
- Step 7 是流程的必要组成部分，用于收集用户反馈和持续改进
- 即使图片生成成功，也必须执行 Step 7
- 不能在 Step 6 后就结束流程

---

## 🔄 执行流程

### Step 0: 输入识别

**场景A：用户上传图片**
- Claude 分析图片（植物种类、构图、色彩、光线、情绪）
- 提取关键视觉元素
- 生成智能推荐

**场景B：用户文字描述**
- 提取植物信息（名称、特征、场景）
- 跳过图片分析步骤

### Step 1: 交互式提问（AskUserQuestion）⚠️ 强制执行

**⚠️ 重要：由于 AskUserQuestion 工具限制（每次最多4个选项），必须分步提问**

**Step 1.1: 第一轮提问**（风格 + 美感）
- 问题1：选择插画风格（单选，4个选项）
  - 清新水彩（推荐）
  - 水墨国画
  - 细腻彩铅
  - 其他风格（油画/彩绘）
- 问题2：选择美感倾向（单选）
  - 东方美感：留白多、意境感、淡雅色调
  - 西方美感：细节丰富、色彩饱满、写实风格

**Step 1.1.5: 条件提问**（如果选择"其他风格"）
- 问题：具体选择哪种风格？（单选）
  - 质感油画
  - 装饰彩绘

**Step 1.2: 第二轮提问**（可选）
- 问题：特殊要求（文字输入，可选）
  - 色调偏好、构图要求、其他说明

**执行逻辑**：
```
1. 第一轮提问 → 获取风格和美感
2. 条件提问 → 如果选择"其他风格"，询问具体是油画还是彩绘
3. 第二轮提问 → 特殊要求（可选）
```

### Step 2: 模型选择（自动执行）

- 读取 `knowledge/style-model-mapping.md`
- 根据风格选择固定模型（保证视觉一致性）
- 彩铅步骤图强制使用 Gemini（中文标注）

### Step 3: Prompt 构建

- 读取 `knowledge/style-prompt-templates.md`
- 选择对应风格的 Prompt 模板
- 融入图片分析结果（如果有）
- 添加用户特殊要求

### Step 4: 系列图片生成

- 调用 `scripts/generate_illustration.py`
- **生成4张系列图片**（同一风格，不同角度/细节）
- 传入参数：风格、模型、prompt、输出路径
- 处理返回结果（Base64 解码或 URL 下载）

**系列生成策略**：
- 图1：整体全景（主体 + 环境）
- 图2：中景特写（主体细节）
- 图3：局部细节（叶片/花瓣纹理）
- 图4：意境氛围（留白 + 情绪）

**注意**：此步骤只生成完成图，不生成步骤图。步骤图将在 Step 7 满意度评级后根据用户需求生成。

### Step 5: 生成小红书标题和标签

- 调用 `scripts/generate_title_tags.py`
- 基于图片系列生成诗意标题（20字以内）
- 生成话题标签（不超过10个）
  - 大标签（3-4个）：进入大流量池
  - 长尾标签（6-7个）：提高搜索率

### Step 6: 保存输出

- 保存到 `.tmp/日期_植物名称/` 目录
- 图片命名：`01_整体全景.png`, `02_中景特写.png` 等
- 步骤图命名：`步骤1_线稿.png`, `步骤2_铺底色.png` 等
- 标题标签：`title_tags.txt`

### Step 6: 结果展示与反馈

- 显示生成的图片路径
- 使用 AskUserQuestion 询问满意度

### Step 7: 满意度评级与后续操作（⚠️ 强制执行，不能跳过）

**满意度选项**：
- 非常满意 ⭐⭐⭐⭐⭐
- 比较满意 ⭐⭐⭐⭐
- 一般满意 ⭐⭐⭐
- 不满意 ❌

**自动处理逻辑**：

**场景A：非常满意（⭐⭐⭐⭐⭐）**
1. 自动添加到正面案例库
2. 调用 `scripts/case_manager.py add-positive`
3. 更新 INDEX.md
4. 提取成功要素
5. **询问是否需要生成步骤图**（使用定稿作为参考）

**场景B：不满意（❌）**
1. 自动添加到反面案例库
2. 调用 `scripts/case_manager.py add-negative`
3. **询问不满意的原因**（使用 AskUserQuestion 或文字输入）
   - 色彩不对？构图不对？风格不对？细节不够？
4. **返回到 Step 3（Prompt 构建）**
   - 保留用户已选择的风格和美感
   - 根据不满意意见调整 Prompt
   - 重新执行 Step 4-6（生成、标题、保存）
5. 再次进入 Step 7 满意度评级

**场景C：一般满意（⭐⭐⭐）**
1. 询问是否需要重新生成
2. 如果需要 → **询问希望调整的方向**
   - 返回到 Step 3（Prompt 构建）
   - 根据调整意见优化 Prompt
   - 重新执行 Step 4-6
3. 如果不需要 → **询问是否需要生成步骤图**（使用定稿作为参考）
4. 不进入案例库

**场景D：比较满意（⭐⭐⭐⭐）**
1. 询问是否需要重新生成
2. 如果需要 → **询问希望调整的方向**
   - 返回到 Step 3（Prompt 构建）
   - 根据调整意见优化 Prompt
   - 重新执行 Step 4-6
3. 如果不需要 → **询问是否需要生成步骤图**（使用定稿作为参考）
4. 不进入案例库

---

### Step 7.5: 步骤图生成（条件执行）

**触发条件**：用户在 Step 7 中选择生成步骤图

**执行流程**：
1. 使用 Step 6 保存的定稿图片作为参考
2. 根据用户选择的风格，生成对应的步骤图（4-6步）
3. 保存到独立的步骤图文件夹

**各风格的步骤图说明**：
- **水彩**：草稿 → 第一层水彩 → 叠加层次 → 细节 → 完成（5步）
- **国画（工笔）**：白描 → 分染 → 罩染 → 提染 → 完成（5步）
- **国画（写意）**：墨稿 → 淡彩 → 浓彩 → 点睛 → 完成（5步）
- **彩铅**：线稿 → 铺底色 → 深化色彩 → 细节刻画 → 完成（5步）
- **油画**：底稿 → 底色 → 中间色 → 高光 → 完成（5步）
- **彩绘**：线稿 → 平涂底色 → 叠加色彩 → 装饰细节 → 完成（5步）

**优势**：
- 步骤图基于最终确认的定稿，保证视觉一致性
- 用户可以先确认风格满意后再决定是否需要步骤图
- 避免生成不满意的步骤图浪费资源

---

## 🛠️ 调用方式

```bash
# 方式1：上传图片后调用
/illustration-converter

# 方式2：文字描述调用
/illustration-converter plant="多肉植物桃蛋"
```

**参数说明：**
| 参数 | 必需 | 默认值 | 说明 |
|------|------|--------|------|
| plant | ❌ | - | 植物名称（如果不上传图片） |

---

## 📦 输出结构

```
/Users/dj/Desktop/小静的skills/illustration-converter/.tmp/
└── 20260131_桃蛋多肉/
    ├── 清新水彩_东方_01_桃蛋多肉.png
    ├── 水墨国画_东方_01_桃蛋多肉.png
    └── 细腻彩铅_步骤图/
        ├── 步骤1_线稿.png
        ├── 步骤2_铺底色.png
        ├── 步骤3_深化色彩.png
        ├── 步骤4_细节刻画.png
        └── 步骤5_完成.png
```

---

## 📝 依赖

### Scripts
- `scripts/generate_illustration.py` - 核心生成脚本
- `scripts/image_analysis.py` - 图片分析脚本（可选）

### Knowledge
- `knowledge/style-prompt-templates.md` - 10种风格的完整 Prompt 模板
- `knowledge/style-model-mapping.md` - 风格-模型映射表（保证稳定性）
- `knowledge/user-friendly-options.md` - 用户友好的选项设计

### 全局配置
- `~/.claude/CLAUDE.md` - API 配置（云雾端点、API Key）

---

## ⚙️ 配置

### API 配置（继承全局配置）

```python
API_BASE_URL = "https://yunwu.ai/v1"
API_KEY = os.getenv("YUNWU_API_KEY")  # 从环境变量读取
```

### 风格-模型映射（固定配置）

```python
STYLE_MODEL_MAPPING = {
    "清新水彩_东方": "gemini-3-pro-image-preview",
    "清新水彩_西方": "gemini-3-pro-image-preview",
    "水墨国画_东方": "gemini-3-pro-image-preview",
    "水墨国画_西方": "gemini-3-pro-image-preview",
    "细腻彩铅_东方": "gemini-3-pro-image-preview",
    "细腻彩铅_西方": "gemini-3-pro-image-preview",
    "细腻彩铅_步骤图": "gemini-3-pro-image-preview",  # 强制
    "质感油画_东方": "gemini-3-pro-image-preview",
    "质感油画_西方": "gemini-3-pro-image-preview",
    "装饰彩绘_东方": "gemini-3-pro-image-preview",
    "装饰彩绘_西方": "gemini-3-pro-image-preview",
}
```

**说明**：
- 默认全部使用 Gemini（支持中文、细腻度高）
- 后续可根据测试结果调整个别风格的模型
- 彩铅步骤图强制 Gemini（中文标注需求）

### 输出路径

```python
OUTPUT_DIR = "/Users/dj/Desktop/小静的skills/illustration-converter/.tmp"
```

---

## ❌ 禁止行为

- ❌ 禁止让 AI 自动选择模型（必须使用固定映射）
- ❌ 禁止跳过交互式提问（必须让用户确认风格）
- ❌ 禁止使用专业美术术语（用户友好的语言）
- ❌ 禁止同一风格使用不同模型（保证视觉一致性）
- ❌ 禁止在 SKILL.md 中包含完整 Prompt（应放在 knowledge/）

---

## 🎨 风格说明（用户友好版本）

### 1. 清新水彩
- **视觉效果**：柔和、透明、自然晕染
- **适合内容**：日常记录、治愈系、生活美学
- **东方美感**：留白多、意境感、淡雅
- **西方美感**：细节丰富、植物插画风格

### 2. 水墨国画
- **视觉效果**：墨韵、写意、诗意
- **适合内容**：传统节日、禅意、文艺
- **东方美感**：传统国画、书法题款
- **西方美感**：现代水墨、融合风格

### 3. 细腻彩铅
- **视觉效果**：笔触细腻、层次丰富、纸张质感
- **适合内容**：教程、写实风格、步骤展示
- **东方美感**：柔和、淡雅、留白
- **西方美感**：写实、色彩饱满、光影明确
- **特殊功能**：支持步骤图（4-6步）

### 4. 质感油画
- **视觉效果**：笔触明显、色彩浓郁、艺术感强
- **适合内容**：高级感、艺术氛围、情感表达
- **东方美感**：含蓄、意境、柔和笔触
- **西方美感**：古典油画、戏剧性光影

### 5. 装饰彩绘
- **视觉效果**：平涂、图案化、装饰性强
- **适合内容**：活泼、现代、设计感
- **东方美感**：民间艺术、装饰纹样
- **西方美感**：现代插画、商业设计

---

## 🔍 智能推荐逻辑

基于图片分析结果，自动推荐最适合的风格：

| 图片特征 | 推荐风格 | 推荐美感 |
|---------|---------|---------|
| 光线柔和、留白多 | 清新水彩 | 东方 |
| 细节丰富、色彩饱满 | 清新水彩 | 西方 |
| 意境感强、简约 | 水墨国画 | 东方 |
| 需要教程展示 | 细腻彩铅 | 根据内容 |
| 高级感、艺术氛围 | 质感油画 | 根据内容 |
| 活泼、图案化 | 装饰彩绘 | 根据内容 |

---

## 📝 版本历史

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| v1.4 | 2026-02-01 | 优化重新生成流程：不满意/一般满意/比较满意时，返回到 Step 3（Prompt 构建）而非 Step 1，保留用户选择，只优化 Prompt |
| v1.3 | 2026-02-01 | 重大优化：(1) 修复 API Key 读取，从全局 .env 文件自动加载；(2) 调整步骤图提问时机，从 Step 1.2 移至 Step 7，使用定稿作为参考生成步骤图 |
| v1.2 | 2026-02-01 | 优化交互流程：分离"油画"和"彩绘"选项，增加条件提问步骤（Step 1.1.5） |
| v1.0 | 2026-01-31 | 初始版本，支持5大风格、步骤图生成、固定模型映射 |

---

**最后更新**：2026-02-01
