---
name: illustration-converter
description: "将真实植物照片转换为多种艺术插画风格（水彩/国画/彩铅/油画/彩绘/工笔），支持系列图和步骤图生成，意境图可添加人物/动物/物品元素"
license: MIT
version: "3.0"
---


## ⚠️ 恢复执行重要提醒

**当用户说"继续Step X"、"继续执行"、"下一步"时**：

本 Skill 的所有步骤都可能需要用户输入或确认。
在恢复执行任何步骤前，请遵循全局"恢复执行强制规则"（~/.claude/CLAUDE.md）：

1. ✅ 先读取该步骤的完整描述
2. ✅ 检查是否需要提问或确认
3. ✅ 确认所有输入参数
4. ✅ 有疑问先问用户

**禁止直接开始执行，禁止假设已知上下文。**

---

# 插画风格转换器 v2.0

## 📋 概述

将真实植物照片转换为艺术插画，支持7大风格类别（水彩/国画/彩铅/油画/彩绘/工笔/装饰工笔），每种风格区分东方/西方美感。

**核心价值**：
- 提升内容视觉多样性
- 真实照片 → 艺术插画，一键转换
- 支持系列图（4张不同构图）和步骤图（5步教程）
- 意境图可添加人物/动物/物品元素，增加故事性
- 智能元素建议系统，根据植物特性推荐合适元素
- 保证同风格视觉一致性（固定模型选择）

**v3.0 更新**：
- 新增画风：工笔花鸟画、现代装饰工笔画
- 意境图元素系统：可选添加人物/动物/物品
- 智能元素建议：根据植物特性自动推荐
- 元素 Prompt 模板库：保证元素与植物和谐融合

---

## 🎯 核心功能

- **双模式生成**：系列图（发布用）或步骤图（教学用），可单独或同时生成
- **风格转换**：7大风格 × 2种美感 = 14种插画风格
- **系列图**：4张不同构图（整体全景、中景特写、局部细节、意境氛围）
- **意境图元素**：可选添加人物/动物/物品元素，增加故事性和情感表达
- **智能元素建议**：根据植物特性自动推荐合适的元素
- **步骤图**：5步渐进教程（线稿 → 淡彩 → 中间色 → 深色细节 → 完成）
- **模型固定**：每种风格固定使用最佳模型，保证视觉一致性

---

## ⚠️ 执行检查清单（强制）

**在执行 Skill 时，必须完成以下所有步骤，不得跳过：**

- [ ] Step 0: 输入识别（图片分析或文字描述）
- [ ] Step 1: 选择生成类型（系列图/步骤图/两者都要）
- [ ] Step 2: 交互式提问（风格、美感、特殊要求）
- [ ] Step 3: 模型选择（自动）
- [ ] Step 4: Prompt 构建（自动）
- [ ] Step 5: 图片生成（根据选择生成对应类型）
- [ ] Step 6: 生成小红书标题和标签（仅系列图）
- [ ] Step 7: 保存输出
- [ ] **Step 8: 满意度评级（强制，不能跳过）** ⚠️

**重要提醒**：
- Step 8 是流程的必要组成部分，用于收集用户反馈和持续改进
- 即使图片生成成功，也必须执行 Step 8
- 不能在 Step 7 后就结束流程

---

## 🔄 执行流程

### Step 0: 输入识别

**场景A：用户上传图片**
- Claude 分析图片（植物种类、构图、色彩、光线、情绪）
- 提取关键视觉元素
- 生成智能推荐
- **继续到 Step 1**（选择生成类型）

**场景B：用户文字描述**
- 提取植物信息（名称、特征、场景）
- **显示限制提示**：
  ```
  ⚠️ 文字描述只支持生成系列图（4张不同构图的插画）

  步骤图需要真实照片作为参考，展示从照片到插画的创作过程。
  如果您需要步骤图，请上传一张植物照片。

  确认生成系列图？
  ```
- 用户确认 → **跳过 Step 1**，直接进入 Step 2（风格选择）
- 用户取消 → 提示上传照片

### Step 1: 选择生成类型（AskUserQuestion）⚠️ 强制执行

**⚠️ 注意：仅当用户上传了照片时执行此步骤。文字描述会跳过此步骤。**

**问题：你想生成什么类型的图片？**

选项（单选）：
1. **系列图**（4张不同构图，用于内容发布）
   - 整体全景、中景特写、局部细节、意境氛围
   - 适合小红书、公众号等平台发布
   - 会生成配套的标题和标签

2. **步骤图**（5步教程图，用于教学展示）
   - 展示从照片到插画的完整绘画过程
   - 适合教程类内容、知识分享
   - 基于原始照片生成，展示真实创作流程

3. **两者都要**（9张图，系列+步骤）
   - 先生成4张系列图
   - 再生成5张步骤图
   - 满足发布和教学双重需求

**执行逻辑**：
- 用户选择后，记录生成类型
- 后续流程根据选择执行对应的生成逻辑
- **关键**：步骤图和系列图都使用原始照片作为参考

### Step 2: 交互式提问（AskUserQuestion）⚠️ 强制执行

**⚠️ 重要：由于 AskUserQuestion 工具限制（每次最多4个选项），必须分步提问**

**Step 2.1: 第一轮提问**（风格 + 美感）
- 问题1：选择插画风格（单选，4个选项）
  - 清新水彩（推荐）
  - 水墨国画
  - 工笔花鸟画（新增）⭐
  - 其他风格（彩铅/油画/彩绘/装饰工笔）
- 问题2：选择美感倾向（单选）
  - 东方美感：留白多、意境感、淡雅色调
  - 西方美感：细节丰富、色彩饱满、写实风格

**Step 2.2: 条件提问**（如果选择"其他风格"）
- 问题：具体选择哪种风格？（单选）
  - 细腻彩铅
  - 质感油画
  - 装饰彩绘
  - 现代装饰工笔画（新增）⭐

**Step 2.3: 意境图元素**（可选，仅系列图）
- 问题：意境图（第4张）是否需要添加特殊元素？（单选）
  - 不需要（推荐，纯植物意境）
  - 添加人物元素
  - 添加动物元素
  - 添加物品元素

**Step 2.4: 元素详细描述**（条件执行）
- 如果 Step 2.3 选择了添加元素：
  - 读取 `knowledge/smart-element-suggestions.md`
  - 根据植物特性显示智能推荐
  - 用户可以接受推荐或自定义描述
  - 示例推荐：
    ```
    植物：多肉植物
    推荐元素：
    - 人物：小女孩正在浇水，穿着园艺围裙
    - 动物：小蜜蜂在花朵周围飞舞
    - 物品：可爱的陶瓷花盆、园艺工具
    ```

**Step 2.5: 特殊要求**（可选）
- 问题：其他特殊要求（文字输入，可选）
  - 色调偏好、构图要求、其他说明

**执行逻辑**：
```
1. 第一轮提问 → 获取风格和美感
2. 条件提问 → 如果选择"其他风格"，询问具体风格
3. 意境图元素 → 询问是否添加元素（仅系列图）
4. 元素详细描述 → 如果添加元素，显示智能推荐
5. 特殊要求 → 其他要求（可选）
```

### Step 3: 模型选择（自动执行）

- 读取 `knowledge/style-model-mapping.md`
- 根据风格选择固定模型（保证视觉一致性）
- 所有风格默认使用 Gemini（支持中文、细腻度高）

### Step 4: Prompt 构建（自动执行）

- 读取 `knowledge/style-prompt-templates.md`
- 选择对应风格的 Prompt 模板
- 融入图片分析结果（如果有）
- 添加用户特殊要求
- **如果用户选择了添加元素**：
  - 读取 `knowledge/atmosphere-with-elements-templates.md`
  - 为意境图（第4张）添加元素描述
  - 确保元素与植物和谐融合，不喧宾夺主

### Step 5: 图片生成

**根据 Step 1 的选择执行对应生成逻辑**：

#### 5A: 生成系列图（如果选择了"系列图"或"两者都要"）

- 调用 `scripts/generate_illustration.py` 的 `generate_series()` 方法
- **生成4张系列图片**（同一风格，不同角度/细节）
- 传入参数：风格、模型、prompt、输出路径、参考图片

**系列生成策略**（植物专用）：
- 图1：局部特写（叶片/花瓣纹理细节）
- 图2：中景视角（植物主体+部分花盆）
- 图3：整体全景（完整植物-花盆单元）
- 图4：意境氛围（植物置于园艺场景）

**参考**：详细构图描述见 `scripts/generate_illustration.py` 第310-348行

#### 5B: 生成步骤图（如果选择了"步骤图"或"两者都要"）

- 调用 `scripts/generate_illustration.py` 的 `generate_style_steps()` 方法
- **生成5张步骤图**（展示绘画技法渐进过程）
- 传入参数：风格、模型、prompt、输出路径、**原始照片**

**步骤生成策略**（通用，适用于所有画风）：
- 步骤1：线稿/底稿（仅轮廓，无颜色）
- 步骤2：第一遍淡色（建立色调）
- 步骤3：第二遍中间色（塑造体积）
- 步骤4：第三遍深色与细节（刻画细节）
- 步骤5：完成与调整（最终效果）

**关键**：
- 每一步都使用上一步的生成结果作为参考图
- 步骤1使用原始照片作为参考
- Prompt 已通用化，根据画风动态调整术语

**参考**：
- 步骤定义：`knowledge/professional-painting-steps.md`
- 实现逻辑：`scripts/generate_illustration.py` 第393-642行

### Step 6: 生成小红书标题和标签（条件执行）

**仅当生成了系列图时执行**：

- 调用 `scripts/generate_title_tags.py`
- 基于图片系列生成诗意标题（20字以内）
- 生成话题标签（不超过10个）
  - 大标签（3-4个）：进入大流量池
  - 长尾标签（6-7个）：提高搜索率

### Step 7: 保存输出

**临时保存**（生成过程中）：
- 保存到 `.tmp/` 目录

**正式保存**（用户满意后）：
- 目标路径：`/Users/dj/Desktop/全域自媒体运营/内容发布/发布记录/2026/插画类/`
- 文件夹命名：`YYYYMMDD_风格名称_植物名称/`
  - 示例：`20260201_清新水彩东方_垂吊多肉植物/`

**文件命名规则**：
- 系列图：`01_局部特写.png`, `02_中景视角.png`, `03_整体全景.png`, `04_意境氛围.png`
- 步骤图：`步骤图_植物名称/步骤1_铅笔稿.png`, `步骤2_第一遍淡彩.png` 等

### Step 8: 满意度评级与后续操作（⚠️ 强制执行，不能跳过）

**满意度选项**：
- 非常满意 ⭐⭐⭐⭐⭐
- 比较满意 ⭐⭐⭐⭐
- 一般满意 ⭐⭐⭐
- 不满意 ❌

**自动处理逻辑**：

**场景A：非常满意（⭐⭐⭐⭐⭐）**
1. 自动添加到正面案例库
2. 调用 `scripts/case_manager.py add-positive`
3. 更新 INDEX.md
4. 提取成功要素

**场景B：不满意（❌）**
1. 自动添加到反面案例库
2. 调用 `scripts/case_manager.py add-negative`
3. **询问不满意的原因**（使用 AskUserQuestion 或文字输入）
   - 色彩不对？构图不对？风格不对？细节不够？
4. **返回到 Step 4（Prompt 构建）**
   - 保留用户已选择的风格和美感
   - 根据不满意意见调整 Prompt
   - 重新执行 Step 5-7（生成、标题、保存）
5. 再次进入 Step 8 满意度评级

**场景C：一般满意（⭐⭐⭐）**
1. 询问是否需要重新生成
2. 如果需要 → **询问希望调整的方向**
   - 返回到 Step 4（Prompt 构建）
   - 根据调整意见优化 Prompt
   - 重新执行 Step 5-7
3. 如果不需要 → 结束流程
4. 不进入案例库

**场景D：比较满意（⭐⭐⭐⭐）**
1. 询问是否需要重新生成
2. 如果需要 → **询问希望调整的方向**
   - 返回到 Step 4（Prompt 构建）
   - 根据调整意见优化 Prompt
   - 重新执行 Step 5-7
3. 如果不需要 → 结束流程
4. 不进入案例库

---

## 🛠️ 调用方式

```bash
# 方式1：上传图片后调用
/illustration-converter

# 方式2：文字描述调用
/illustration-converter plant="多肉植物桃蛋"
```

**参数说明：**
| 参数 | 必需 | 默认值 | 说明 |
|------|------|--------|------|
| plant | ❌ | - | 植物名称（如果不上传图片） |

---

## 📦 输出结构

```
/Users/dj/Desktop/全域自媒体运营/内容发布/发布记录/2026/插画类/
└── 20260201_清新水彩东方_垂吊多肉植物/
    ├── 01_局部特写.png
    ├── 02_中景视角.png
    ├── 03_整体全景.png
    ├── 04_意境氛围.png
    ├── title_tags.txt
    └── 步骤图_垂吊多肉植物/
        ├── 步骤1_铅笔稿.png
        ├── 步骤2_第一遍淡彩.png
        ├── 步骤3_第二遍中间色.png
        ├── 步骤4_第三遍深色与细节.png
        └── 步骤5_完成与调整.png
```

---

## 📝 依赖

### Scripts
- `scripts/generate_illustration.py` - 核心生成脚本
  - `generate_series()` - 生成4张系列图
  - `generate_style_steps()` - 生成5张步骤图
- `scripts/generate_title_tags.py` - 标题标签生成
- `scripts/case_manager.py` - 案例管理

### Knowledge
- `knowledge/style-prompt-templates.md` - 10种风格的完整 Prompt 模板
- `knowledge/style-model-mapping.md` - 风格-模型映射表
- `knowledge/professional-painting-steps.md` - 各画种的学术标准步骤定义
- `knowledge/smart-element-suggestions.md` - 智能元素推荐系统（v3.0 新增）
- `knowledge/atmosphere-with-elements-templates.md` - 元素 Prompt 模板库（v3.0 新增）

### 质量保证文档（v2.1 新增）
- `knowledge/complete-optimization-record.md` - 完整优化记录（6轮优化历程）
- `knowledge/anti-patterns-cases.md` - 反面案例库（5大核心问题）
- `knowledge/user-aesthetic-preferences.md` - 用户审美习惯和要求
- `knowledge/quick-reference-guide.md` - 快速参考指南（生成前检查清单）
- `knowledge/cross-style-issue-analysis.md` - 跨画风问题分析
- `knowledge/universal-optimization-log.md` - 通用优化应用日志

**使用说明**：
- 生成前：查阅 `quick-reference-guide.md` 检查 Prompt
- 遇到问题：查阅 `anti-patterns-cases.md` 快速修复
- 了解用户偏好：查阅 `user-aesthetic-preferences.md`
- 完整优化历程：查阅 `complete-optimization-record.md`

### 全局配置
- `~/.claude/CLAUDE.md` - API 配置（云雾端点、API Key）

---

## ⚙️ 配置

### API 配置（继承全局配置）

```python
API_BASE_URL = "https://yunwu.ai/v1"
API_KEY = os.getenv("YUNWU_API_KEY")  # 从环境变量读取
```

### 风格-模型映射（固定配置）

所有风格默认使用 `gemini-3-pro-image-preview`（支持中文、细腻度高）

详见：`knowledge/style-model-mapping.md`

### 输出路径

```python
OUTPUT_DIR = "/Users/dj/Desktop/全域自媒体运营/内容发布/发布记录/2026/插画类"
```

---

## ❌ 禁止行为

- ❌ 禁止让 AI 自动选择模型（必须使用固定映射）
- ❌ 禁止跳过交互式提问（必须让用户确认风格）
- ❌ 禁止使用专业美术术语（用户友好的语言）
- ❌ 禁止同一风格使用不同模型（保证视觉一致性）
- ❌ 禁止在 SKILL.md 中包含完整 Prompt（应放在 knowledge/）
- ❌ 禁止用系列图作为步骤图的参考（必须用原始照片）

---

## 📝 更新规范

**更新本 Skill 时，请遵循"渐进式披露"和"Skill 精简"原则**

- SKILL.md：只包含核心工作流程和简要说明
- knowledge/：包含详细内容、案例、分析
- 通过引用而非复制来关联文档

**详细更新规范**：`UPDATE-GUIDELINES.md`

---

## 🎨 风格说明（用户友好版本）

### 1. 清新水彩
- **视觉效果**：柔和、透明、自然晕染
- **适合内容**：日常记录、治愈系、生活美学
- **东方美感**：留白多、意境感、淡雅
- **西方美感**：细节丰富、植物插画风格

### 2. 水墨国画
- **视觉效果**：墨韵、写意、诗意
- **适合内容**：传统节日、禅意、文艺
- **东方美感**：传统国画、书法题款
- **西方美感**：现代水墨、融合风格

### 3. 工笔花鸟画（新增）⭐
- **视觉效果**：色彩鲜艳、细节精致、花鸟主题
- **适合内容**：传统节日、高品质插画、装饰画
- **东方美感**：传统工笔技法、细腻勾勒、诗意构图
- **西方美感**：现代工笔、色彩饱满、写实风格
- **参考案例**：`knowledge/插画参考/03-工笔花鸟画/`（3张参考图）

### 4. 细腻彩铅
- **视觉效果**：笔触细腻、层次丰富、纸张质感
- **适合内容**：教程、写实风格、步骤展示
- **东方美感**：柔和、淡雅、留白
- **西方美感**：写实、色彩饱满、光影明确

### 4. 质感油画
- **视觉效果**：笔触明显、色彩浓郁、艺术感强
- **适合内容**：高级感、艺术氛围、情感表达
- **东方美感**：含蓄、意境、柔和笔触
- **西方美感**：古典油画、戏剧性光影

### 5. 装饰彩绘
- **视觉效果**：平涂、图案化、装饰性强
- **适合内容**：活泼、现代、设计感
- **东方美感**：民间艺术、装饰纹样
- **西方美感**：现代插画、商业设计

### 6. 现代装饰工笔画（新增）⭐
- **视觉效果**：金色装饰线条、梦幻效果、现代审美
- **适合内容**：高端装饰画、奢华感、艺术性强
- **特点**：融合传统工笔与现代装饰元素，带有金色纹理和光泽感
- **参考案例**：`knowledge/插画参考/04-现代装饰工笔画/`（1张参考图）

---

## 📝 版本历史

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| v3.0 | 2026-02-02 | 重大更新：(1) 新增画风：工笔花鸟画、现代装饰工笔画；(2) 意境图元素系统：可选添加人物/动物/物品；(3) 智能元素建议系统；(4) 元素 Prompt 模板库；(5) 从10种画风扩展到14种画风 |
| v2.1 | 2026-02-02 | 通用优化版：(1) 基于金鱼草测试完成6轮优化；(2) 修复5大核心问题（风格特征、构图差异、画纸背景、植物逻辑、花朵密度）；(3) 通用优化应用到所有10种画风；(4) 创建完整的问题记录和反面案例库；(5) 提炼用户审美习惯文档 |
| v2.0 | 2026-02-01 | 重大更新：(1) 重新设计工作流程，系列图和步骤图独立生成；(2) 步骤图统一使用原始照片作为参考；(3) 步骤图 prompt 通用化，适用于所有画风；(4) 简化用户决策流程 |
| v1.5 | 2026-02-01 | 优化重新生成流程，不满意时返回 Step 3 而非 Step 1 |
| v1.4 | 2026-02-01 | 修复 API Key 读取，从全局 .env 文件自动加载 |
| v1.0 | 2026-01-31 | 初始版本，支持5大风格、步骤图生成、固定模型映射 |

---

**最后更新**：2026-02-02
