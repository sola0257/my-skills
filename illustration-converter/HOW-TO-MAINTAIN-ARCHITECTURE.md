# 如何确保持续遵循架构原则

**问题**：如何确保每次更新都遵循"渐进式披露"和"Skill 精简"原则？

**解决方案**：建立完整的规范、检查和流程机制

---

## 🛡️ 三层保障机制

### 第1层：文档规范
**文件**：`UPDATE-GUIDELINES.md`

**内容**：
- 核心原则说明
- 更新前检查清单
- 4种更新场景的具体规范
- 禁止的更新模式
- 更新后检查清单
- 快速决策树

**使用时机**：每次更新前必读

---

### 第2层：自动检查
**文件**：`check-skill-structure.sh`

**功能**：
- 检查 SKILL.md 行数（警告 > 500 行）
- 检查 knowledge/ 目录结构
- 检查必要文档是否存在

**使用方法**：
```bash
cd /Users/dj/.claude/skills/illustration-converter
./check-skill-structure.sh
```

**使用时机**：每次更新后运行

---

### 第3层：SKILL.md 提醒
**位置**：SKILL.md 的"更新规范"章节

**内容**：
- 明确说明架构原则
- 引用详细更新规范
- 提醒更新者遵循原则

**作用**：在 SKILL.md 中直接提醒

---

## 📋 标准更新流程

### 步骤1：更新前
1. 阅读 `UPDATE-GUIDELINES.md`
2. 完成"更新前检查清单"
3. 确定内容应该放在哪里

### 步骤2：执行更新
1. 如果是详细内容 → 更新/创建 knowledge/ 文档
2. 如果是核心流程 → 更新 SKILL.md（保持精简）
3. 在 SKILL.md 中添加引用（如果需要）
4. 更新 knowledge/README.md（如果添加了新文档）

### 步骤3：更新后
1. 运行 `./check-skill-structure.sh`
2. 完成"更新后检查清单"
3. 检查是否有重复内容
4. 更新版本号和更新日志

---

## 🎯 快速决策指南

### 问：这个内容应该放在哪里？

**决策树**：
```
是核心工作流程？
├─ 是 → SKILL.md（1-3句简要说明）
│         + knowledge/（详细内容）
│         + SKILL.md 中添加引用
└─ 否 → knowledge/（详细内容）
          + SKILL.md 中添加引用（如果需要）
```

### 问：如何判断是否"核心工作流程"？

**核心工作流程**：
- 用户执行 Skill 必须知道的步骤
- 影响 Skill 执行顺序的决策点
- 必须的输入/输出说明

**不是核心流程**：
- 详细的技术实现
- 完整的 Prompt 模板
- 问题分析和案例
- 优化历程和记录

---

## 📊 当前架构状态

### ✅ 已建立的保障

1. **UPDATE-GUIDELINES.md**
   - 完整的更新规范
   - 4种场景的具体指导
   - 检查清单和决策树

2. **check-skill-structure.sh**
   - 自动检查 SKILL.md 行数
   - 检查目录结构
   - 检查必要文档

3. **SKILL.md 提醒**
   - "更新规范"章节
   - 明确引用更新指南

4. **knowledge/README.md**
   - 文档结构说明
   - 使用场景指南
   - 更新原则

### 📈 检查结果

```
📄 SKILL.md 行数: 443 ✅
📚 knowledge/ 文档: 13个 ✅
✅ 更新规范文档存在
✅ knowledge/README.md 存在
```

---

## 🔄 持续改进

### 定期维护（建议每月）

1. **运行结构检查**
   ```bash
   ./check-skill-structure.sh
   ```

2. **审查 SKILL.md**
   - 是否有内容可以移到 knowledge/
   - 是否有过时的内容
   - 引用是否清晰

3. **整理 knowledge/**
   - 合并相似文档
   - 更新过时信息
   - 检查引用关系

### 发现问题时

1. **SKILL.md 过长**
   - 识别可以移到 knowledge/ 的内容
   - 创建对应的 knowledge/ 文档
   - 在 SKILL.md 中用引用替代

2. **内容重复**
   - 确定权威来源（通常是 knowledge/）
   - 删除重复内容
   - 添加引用

3. **引用断裂**
   - 检查被引用的文档是否存在
   - 更新引用路径
   - 确保引用清晰明确

---

## 💡 最佳实践

### 1. 先写详细，再提炼
- 先在 knowledge/ 写完整文档
- 再提炼核心要点到 SKILL.md
- 这样可以确保 SKILL.md 保持精简

### 2. 使用明确的引用
```markdown
✅ 详见 `knowledge/xxx.md`
✅ 参考 `knowledge/xxx.md` 的 [章节名称]
❌ 详见相关文档（不明确）
```

### 3. 定期运行检查
- 每次更新后运行
- 每月定期检查
- 发现问题及时调整

---

## 🎓 学习资源

### 理解架构原则

**渐进式披露（Progressive Disclosure）**：
- 用户首先看到最重要的信息
- 详细信息通过引用逐步展开
- 避免信息过载

**Skill 精简（Skill Simplicity）**：
- 保持 SKILL.md 简洁易读
- 通过引用而非复制关联内容
- 便于维护和更新

### 参考文档

- `UPDATE-GUIDELINES.md` - 完整更新规范
- `knowledge/README.md` - 文档结构说明
- `SKILL.md` - 当前架构示例

---

## ✅ 总结

### 如何确保持续遵循原则？

1. **更新前**：阅读 UPDATE-GUIDELINES.md
2. **更新时**：遵循决策树和场景规范
3. **更新后**：运行 check-skill-structure.sh
4. **定期**：每月审查和整理

### 三个关键问题

每次更新时问自己：
1. 这个内容是核心流程吗？
2. 是否会造成重复？
3. SKILL.md 是否保持精简？

### 一个核心原则

**SKILL.md 精简，knowledge/ 详细，通过引用关联**

---

**创建时间**：2026-02-02
**适用范围**：所有 Skill 更新
**维护者**：所有更新 Skill 的人员
