# Knowledge Extractor - 验证矩阵

本文档用于测试 `knowledge-extractor` Skill 的触发准确性和执行正确性。

---

## 一、触发测试

### ✅ 应该触发的请求

| 测试用例 | 输入 | 预期行为 |
|----------|------|----------|
| 基础触发 | "整理知识文档 /path/to/folder" | 触发 Skill，开始处理指定文件夹 |
| 中文自然语言 | "帮我整理一下这个文件夹的知识" | 触发 Skill，询问文件夹路径或使用上下文路径 |
| 提取方法论 | "提取这些文档的方法论" | 触发 Skill |
| 生成汇总 | "生成知识库汇总" | 触发 Skill |
| 带模板参数 | "整理知识文档 /path --模板:植物养护" | 触发 Skill，使用植物养护模板 |

### ❌ 不应该触发的请求

| 测试用例 | 输入 | 预期行为 |
|----------|------|----------|
| 单文件阅读 | "帮我读一下这个文件" | 不触发，使用普通文件阅读 |
| 知识问答 | "什么是内容营销？" | 不触发，直接回答问题 |
| 文件搜索 | "找一下关于抖音的文档" | 不触发，使用文件搜索功能 |
| 写作请求 | "帮我写一篇小红书文案" | 不触发，触发其他写作 Skill |

---

## 二、功能测试

### 2.1 增量处理测试

| 测试场景 | 初始状态 | 操作 | 预期结果 |
|----------|----------|------|----------|
| 首次处理 | 无 .processed_files.json | 执行处理 | 创建记录文件，处理所有文件 |
| 重复执行 | 已有完整记录 | 再次执行 | 跳过所有已处理文件，报告"本次处理: 0" |
| 新增文件 | 已有记录 + 新增1个文件 | 执行处理 | 只处理新增文件，更新记录 |
| 文件更新 | 已有记录 + 修改1个已处理文件 | 执行处理 | 重新处理该文件，更新记录 |

### 2.2 空文件处理测试

| 测试场景 | 文件内容 | 预期结果 |
|----------|----------|----------|
| 空文件 | 0 字节 | 跳过，记录到日志，标记 status: "skipped" |
| 纯链接 | 仅含 "https://example.com" | 跳过，记录原因 |
| 极短内容 | < 50 字符正文 | 跳过，记录原因 |
| 正常文件 | > 100 字符有效内容 | 正常处理 |

### 2.3 模板选择测试

| 测试场景 | 条件 | 预期使用模板 |
|----------|------|--------------|
| 显式指定 | 用户输入 `--模板:植物养护` | 植物养护模板 |
| 已有汇总 | 文件夹内已有 `方法论汇总.md` | 沿用已有结构 |
| 智能推断-运营 | 内容涉及小红书、抖音等 | 新媒体运营模板 |
| 智能推断-植物 | 内容涉及植物养护、绿植等 | 植物养护模板 |
| 无法判断 | 内容领域不明确 | 通用知识模板 |

### 2.4 多格式文件测试

| 文件格式 | 测试文件 | 预期行为 |
|----------|----------|----------|
| .md | test.md | 直接读取，正常提取 |
| .txt | test.txt | 直接读取，正常提取 |
| .html | test.html | 解析正文，正常提取 |
| .pdf | test.pdf | 工具提取文本，正常提取 |
| .docx | test.docx | 工具提取文本，正常提取 |
| .jpg | test.jpg | 视觉读取，正常提取 |
| .unknown | test.xyz | 跳过，记录"不支持的格式" |

---

## 三、分类测试

### 3.1 内容形式分类

| 文档内容关键词 | 预期分类 |
|----------------|----------|
| "图文排版"、"文案写作"、"标题技巧" | 图文内容方法论 |
| "视频拍摄"、"剪辑技巧"、"脚本" | 短视频方法论 |
| "直播话术"、"直播间转化" | 直播方法论 |
| "社群运营"、"私域"、"会员体系" | 私域/社群运营方法论 |

### 3.2 平台特性分类

| 文档内容关键词 | 预期分类 |
|----------------|----------|
| "小红书算法"、"笔记收藏" | 小红书平台规则 |
| "抖音推荐"、"同城流量" | 抖音平台规则 |
| "公众号推送"、"订阅号" | 公众号平台规则 |
| "视频号推荐"、"微信生态" | 视频号平台规则 |

### 3.3 多维度分类

| 文档内容 | 预期归入的分类 |
|----------|----------------|
| "小红书图文标题技巧+钩子原理" | 图文内容方法论 + 小红书平台规则 + 内容创作底层逻辑 |
| "抖音短视频脚本+用户心理" | 短视频方法论 + 抖音平台规则 + 用户心理与转化逻辑 |

---

## 四、错误恢复测试

| 测试场景 | 模拟错误 | 预期行为 |
|----------|----------|----------|
| 单文件读取失败 | 文件权限不足 | 跳过该文件，继续处理其他文件 |
| 汇总文件锁定 | 文件被其他程序占用 | 报告错误，但不中断已提取内容 |
| 中途中断 | 处理到一半用户取消 | 已处理部分已写入 .processed_files.json |

---

## 五、边界情况测试

| 测试场景 | 预期行为 |
|----------|----------|
| 空文件夹 | 报告"扫描文件总数: 0"，正常结束 |
| 超大文件夹 (1000+ 文件) | 分批处理，不超时 |
| 嵌套子文件夹 | 递归处理所有层级 |
| 文件名含特殊字符 | 正常处理，正确记录路径 |
| 重复内容文档 | 去重检查，跳过或合并 |

---

## 六、输出验证

### 6.1 汇总文档格式检查

- [ ] 目录自动更新
- [ ] 每个方法论包含必填字段（名称、适用场景、核心框架、跨平台适用性、来源文件）
- [ ] Markdown 格式正确，无语法错误
- [ ] 新增内容追加到正确分类下

### 6.2 处理报告格式检查

- [ ] 包含处理时间
- [ ] 包含处理统计表格
- [ ] 包含新增方法论清单
- [ ] 包含跳过文件列表

### 6.3 记录文件检查

- [ ] .processed_files.json 格式正确
- [ ] metadata 包含 last_run 时间戳
- [ ] 每个文件记录包含必要字段

---

## 七、测试执行记录

| 日期 | 测试版本 | 测试人 | 通过率 | 备注 |
|------|----------|--------|--------|------|
| 2026-01-13 | v1.0 | - | - | 初始版本 |

---

*本验证矩阵将随 Skill 迭代持续更新*
