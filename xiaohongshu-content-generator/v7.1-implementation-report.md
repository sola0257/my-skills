# 小红书配图优化 v7.1 - 四层机制实施报告

**实施日期**：2026-01-29
**版本**：v7.1
**架构**：四层机制

---

## ✅ 已完成的改动

### 第1层：指令层（SKILL.md）

**位置**：`/Users/dj/.claude/skills/xiaohongshu-content-generator/SKILL.md`

**改动内容**：
- 添加 `[必需] 配图基本要求` 部分
- 标注核心要求：数量、尺寸、命名、类型
- 添加强制执行规则和检查点
- **保持精简**：只保留核心要求，不添加过多示例

**关键内容**：
```markdown
#### [必需] 配图基本要求

**数量**：12-15张
**尺寸**：1080x1440像素（3:4竖版）
**命名**：`序号_建议文字说明.png`
**类型**：对比图、步骤图、细节图

⚠️ **强制执行**：
- 配图数量不得少于12张
- 配图尺寸必须为3:4竖版
- 文字说明必须简洁（5-8个字）
```

---

### 第2层：规则层（CLAUDE.md）

**位置**：`/Users/dj/.claude/CLAUDE.md`

**改动内容**：
- 在"内容生成执行强制规则"部分添加"规则2：小红书配图强制要求"
- 定义适用范围、配图规格、执行流程、检查点

**关键内容**：
```markdown
### 规则2：小红书配图强制要求

**适用范围**：`xiaohongshu-content-generator`

**[必需] 配图规格**：
- 数量：12-15张（不得少于12张）
- 尺寸：1080x1440像素（3:4竖版）
- 命名：`序号_建议文字说明.png`
- 文字说明：5-8个字，简洁、信息性强
```

---

### 代码更新（scripts/generate_xhs_post.py）

**改动内容**：
1. 删除 `cover_generator` 导入（不再需要文字叠加）
2. 添加 `aspect_ratio` 参数支持3:4尺寸
3. 添加 `image_labels` 参数支持中文标签命名
4. 简化封面生成（只生成 cover.png，不叠加文字）

**关键改动**：
```python
def generate_image_yunwu(prompt, output_path, aspect_ratio="3:4"):
    # 添加尺寸约束
    size_hint = "Image size: 1080x1440 pixels (3:4 vertical format)"

# 支持中文标签命名
label = image_labels.get(key, "")
filename = f"{key}_{label}.png" if label else f"{key}.png"
```

---

## 📋 待实施的层级

### 第3层：检测层（Hooks）

**状态**：待实施

**建议实施**：
- 创建 Hook 检测配图数量、尺寸、命名
- 检测点：
  - 配图数量是否达到12-15张
  - 配图尺寸是否为1080x1440
  - 文件命名是否包含中文标签
  - 文字说明是否简洁（5-8个字）

**参考文档**：
`/Users/dj/Desktop/小静的skills/skill-standards/knowledge/execution-quality-assurance.md`

---

### 第4层：反馈层（instincts.json）

**状态**：待实施

**建议实施**：
- 记录配图相关问题到 instincts.json
- 下次执行前读取提醒
- 形成学习闭环

---

## 🎯 核心改进

### 1. 配图数量
- **旧版**：3-5张
- **新版**：12-15张（强制）

### 2. 配图尺寸
- **旧版**：未指定
- **新版**：1080x1440（3:4竖版，强制）

### 3. 配图命名
- **旧版**：`01.png`, `02.png`
- **新版**：`01_浇水过多易烂根.png`（含建议文字说明）

### 4. 封面处理
- **旧版**：生成底图 + 叠加文字 → cover_final.png
- **新版**：只生成 cover.png（无文字）

### 5. 架构优化
- **旧版**：所有细节都在 SKILL.md 中
- **新版**：四层机制，保持 SKILL.md 精简

---

## 📝 使用示例

### 调用方式

```python
data = {
    "base_dir": "/path/to/output",
    "prompts": {
        "cover": "封面 prompt...",
        "01": "配图1 prompt...",
        "02": "配图2 prompt...",
        # ... 12-15张配图
    },
    "image_labels": {
        "01": "浇水过多易烂根",
        "02": "每天4小时光照",
        "03": "颗粒土占比60%",
        # ... 对应的文字说明
    }
}
```

### 输出结果

```
output/
├── cover.png                    # 封面（无文字）
├── 01_浇水过多易烂根.png        # 配图1
├── 02_每天4小时光照.png         # 配图2
├── 03_颗粒土占比60%.png         # 配图3
├── ...
└── 15_养护3个月后.png           # 配图15
```

---

## ✅ 架构优势

### 1. 保持精简
- SKILL.md 只保留核心要求
- 不添加过多示例和细节
- 符合渐进披露原则

### 2. 全局约束
- CLAUDE.md 中的规则适用于所有执行
- 在执行前就有约束
- 不依赖单个 SKILL.md

### 3. 可扩展
- 第3层（Hook）可以后续添加
- 第4层（instincts.json）可以逐步完善
- 不破坏现有架构

---

## 📊 版本信息

- **版本**：v7.1
- **更新日期**：2026-01-29
- **架构**：四层机制
- **状态**：第1层和第2层已完成，第3层和第4层待实施

---

**参考文档**：
- 四层机制完整文档：`/Users/dj/Desktop/小静的skills/skill-standards/knowledge/execution-quality-assurance.md`
- 快速参考指南：`/Users/dj/Desktop/小静的skills/skill-standards/knowledge/execution-quality-assurance-quick-guide.md`
