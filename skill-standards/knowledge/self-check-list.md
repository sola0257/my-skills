# ✅ Skill 发布前自检清单

> 每次 Skill 开发或优化完成后，自动执行此清单检查

---

## 🔴 严重（必须通过）

以下检查项不通过将阻止发布：

### 1. 静默执行协议
**检查项：**
- [ ] 包含 `## 🚨 静默执行协议` 章节
- [ ] 包含 `禁止 请求确认` 规则
- [ ] 包含 `禁止 询问` 规则
- [ ] 包含 `禁止 中途停顿` 规则
- [ ] 包含 `必须 一次性` 规则

**检测正则：**
```
r"禁止.*请求确认"
r"禁止.*询问"
r"禁止.*中途停顿"
r"必须.*一次性"
```

---

### 2. 知识库引用一致性
**检查项：**
- [ ] 所有 `knowledge/*.md` 引用文件存在
- [ ] 所有 `file://` 引用路径有效
- [ ] 跨 Skill 引用使用绝对路径

**检测方法：**
```python
# 提取所有引用
refs = re.findall(r'\[.*?\]\((.*?\.md)\)', content)
# 验证每个引用文件存在
for ref in refs:
    assert os.path.exists(resolve_path(ref))
```

---

### 3. 组合Skill同步（如适用）
**检查项：**
- [ ] 如果是组合类 Skill，检查分支 Skills 是否存在
- [ ] 分支 Skills 是否包含相同的规则
- [ ] 分支 Skills 是否能独立运行

**适用条件：**
Skill 内容包含 `Pipeline`、`流水线`、`依赖 Skill` 等关键词

---

## 🟡 中等（强烈建议）

以下检查项不通过会产生警告：

### 4. 输出模板完整性
**检查项：**
- [ ] 包含 `## 📄 输出模板` 或类似章节
- [ ] 模板使用 markdown 代码块包裹
- [ ] 模板包含完整的输出结构

---

### 5. Anti-Patterns 定义
**检查项：**
- [ ] 包含 `## ❌ Anti-Patterns` 或「禁止行为」章节
- [ ] 至少包含 2 个禁止示例
- [ ] 每个示例包含正确做法说明

---

### 6. 错误处理表
**检查项：**
- [ ] 包含 `## 🛠️ 错误处理` 章节
- [ ] 使用表格形式定义
- [ ] 覆盖常见错误场景（输入模糊、API超时、文件不存在等）

---

### 7. 默认值定义
**检查项：**
- [ ] 文档中包含「默认」关键词
- [ ] 明确定义每个可选参数的默认值
- [ ] 默认值合理且安全

---

### 8. Skill 协作声明
**检查项：**
- [ ] 如有依赖，包含 `## 🔗 依赖 Skill` 章节
- [ ] 依赖的 Skills 都存在于 `/小静的skills/` 目录

---

### 9. Token 成本意识（文本处理类 Skill）
**检查项：**
- [ ] 如涉及大量文本处理，是否有成本优化策略
- [ ] 是否采用本地预处理
- [ ] 是否有增量处理机制

**适用条件：**
Skill 内容包含 `读取文件`、`提取`、`分析` 等关键词

---

## 🟢 轻微（建议）

以下检查项不通过会产生提示：

### 10. 临时文件规范
**检查项：**
- [ ] 包含 `## 📁 临时文件管理` 章节
- [ ] 定义 `.tmp/` 目录规则
- [ ] 说明清理策略

---

### 11. 版本历史记录
**检查项：**
- [ ] Frontmatter 中包含 `version` 字段
- [ ] 包含 `## 📝 版本历史` 章节
- [ ] 版本号一致

---

## 📊 检查结果输出格式

```markdown
## ✅ Skill 发布前自检报告

**Skill：** [skill-name]
**检查时间：** [YYYY-MM-DD HH:mm]

### 检查结果

| 级别 | 通过 | 警告 | 错误 |
|------|------|------|------|
| 🔴 严重 | X | 0 | Y |
| 🟡 中等 | X | Y | 0 |
| 🟢 轻微 | X | Y | 0 |

### 🔴 需要修复

1. **[规则名称]**
   - 问题：[具体问题]
   - 建议：[修复建议]

### ⚠️ 警告

1. **[规则名称]**
   - 问题：[具体问题]
   - 建议：[修复建议]

### ✅ 通过的检查项

- R01 静默执行协议 ✓
- R02 输出模板完整性 ✓
- ...

---

**发布建议：** [可以发布 / 建议修复后发布 / 需要修复才能发布]
```

---

## 自动触发规则

此清单在以下场景自动执行：

1. **Skill 开发完成时**
   - 在 Skill 创建完成后自动运行
   - 输出检查报告

2. **Skill 优化完成时**
   - 在 Skill 修改完成后自动运行
   - 验证修改是否引入新问题

3. **用户明确要求时**
   - 触发词：「检查 [skill-name]」「自检 [skill-name]」
