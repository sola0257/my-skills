# REFACTOR Phase 分析报告

> **生成时间**: 2026-02-07
> **分析对象**: topic-discovery v4.1 SKILL.md
> **分析方法**: 代码审查 + 逃逸路径识别

---

## 🎯 分析目标

识别 AI 可能跳过步骤、合理化偷懒、或误解指令的"逃逸路径"。

---

## 🚨 发现的问题（按严重程度排序）

### 🔴 严重问题（P0 - 必须修复）

#### 问题1: 缺少 Step 0（苏格拉底式提问）

**位置**: 执行流程章节（Line 121）

**问题描述**:
- CLAUDE.md 全局规则提到"Step 0: 苏格拉底式提问（强制）"
- 但 SKILL.md 的执行流程直接从 Step 1 开始
- AI 可能会跳过提问，直接开始执行

**逃逸路径**:
```
AI 合理化: "用户已经说了关键词，不需要再问了"
AI 合理化: "SKILL.md 没有 Step 0，所以不需要执行"
```

**修复建议**:
在 Line 121 之后添加 Step 0：
```markdown
### Step 0: 苏格拉底式提问（强制）

**⚠️ 必须使用 AskUserQuestion 工具**

询问以下信息：
1. 内容平台（小红书/公众号/视频号/快手/抖音）
2. 内容目的（涨粉/转化/品牌）
3. 选题方向（用户指定 or AI推荐）
```

---

#### 问题2: "静默执行协议"与"提问要求"冲突

**位置**: Line 27-36（静默执行协议）

**问题描述**:
- 静默执行协议说"禁止中途停顿等待用户反馈"
- 但 Step 0 需要 AskUserQuestion
- AI 可能会困惑：到底要不要问用户？

**逃逸路径**:
```
AI 合理化: "静默执行协议说禁止提问，所以跳过 Step 0"
AI 合理化: "我假设用户想要全平台选题，不需要问"
```

**修复建议**:
在静默执行协议中明确说明：
```markdown
**执行规则：**
- ✅ **Step 0 必须提问**（使用 AskUserQuestion 工具）
- ❌ **Step 1-5 禁止中途停顿**（静默执行）
- ❌ **禁止** 请求确认以继续
```

---

#### 问题3: v4.1 新增字段未标记为 MANDATORY

**位置**: Line 198-199（用户痛点、互动引导策略）

**问题描述**:
- v4.1 新增了两个字段
- 但在 Step 4 的表格中只是列出，没有明确说"必须包含"
- AI 可能会认为这是可选字段

**逃逸路径**:
```
AI 合理化: "这是 v4.1 新增的，可能是可选功能"
AI 合理化: "用户没有明确要求这两个字段，可以省略"
```

**修复建议**:
在 Line 191 之后添加：
```markdown
**⚠️ v4.1 强制要求：以下字段为必填项，不得省略**
- 用户痛点（核心问题 + 困扰原因 + 解决方案）
- 互动引导策略（内容设计 + 引导话术 + 预期互动 + 回复策略）
```

---

#### 问题4: 账号阶段读取缺少验证机制

**位置**: Line 246-261（阶段判断）

**问题描述**:
- 说"⚠️ 强制要求：必须先读取账号配置，不能假设"
- 但没有验证机制确保 AI 真的读取了
- AI 可能会说"我读取了"但实际上是假设的

**逃逸路径**:
```
AI 合理化: "我记得上次读取的结果是起号期，不需要再读"
AI 合理化: "用户说了0粉，我知道是起号期"
AI 行为: 说"我读取了账号配置"但实际上没有调用 Read 工具
```

**修复建议**:
添加显式的验证步骤：
```markdown
**验证步骤**（必须执行）：
1. 使用 Read 工具读取 ~/.claude/CLAUDE.md
2. 提取"多平台账号配置"章节
3. 输出当前粉丝数和账号阶段
4. 基于读取结果选择策略A或策略B

**⚠️ 禁止行为**：
- ❌ 说"我读取了"但没有实际调用 Read 工具
- ❌ 基于记忆或假设判断账号阶段
- ❌ 跳过读取步骤直接执行
```

---

#### 问题5: 双层去重代码未明确要求执行

**位置**: Line 357-410（双层去重写入）

**问题描述**:
- 提供了详细的 Python 代码
- 但没有明确说"必须执行这段代码"
- AI 可能会认为这只是示例代码，不需要实际执行

**逃逸路径**:
```
AI 合理化: "这是示例代码，我理解逻辑就行"
AI 合理化: "我会在输出中描述去重逻辑，不需要实际执行"
AI 行为: 输出商品建议但不检查重复
```

**修复建议**:
在 Line 346 之前添加：
```markdown
**⚠️ 强制执行要求**：
- ✅ 必须实际执行以下去重逻辑（不是描述，是执行）
- ✅ 必须调用 Feishu MCP 工具写入商品
- ✅ 必须计算并输出重复率和品类分布
- ❌ 禁止只输出商品列表而不执行去重
- ❌ 禁止说"我会去重"但实际上没有检查
```

---

### 🟡 中等问题（P1 - 建议修复）

#### 问题6: Step 2 的 deep_research 可能被跳过

**位置**: Line 140-148（深度行业研究）

**问题描述**:
- 说"必须使用 GPT Researcher MCP"
- 但紧接着说"如果返回 429 错误，必须使用 WebSearch"
- AI 可能会直接跳到 WebSearch，不尝试 deep_research

**逃逸路径**:
```
AI 合理化: "deep_research 可能会失败，我直接用 WebSearch 更稳妥"
AI 合理化: "WebSearch 速度快，用户不会注意到区别"
```

**修复建议**:
添加执行顺序验证：
```markdown
**执行顺序（强制）**：
1. ✅ 先尝试 mcp__gptr-mcp__deep_research
2. ✅ 如果返回 429 或其他错误，输出错误信息
3. ✅ 然后使用 WebSearch 作为备选
4. ❌ 禁止不尝试 deep_research 直接用 WebSearch
```

---

#### 问题7: 飞书写入可能被跳过

**位置**: Line 550-578（Step 5）

**问题描述**:
- 说"不再保存到本地文件，改为输出到飞书"
- 但又说"完整的选题详情仍需在对话中输出"
- AI 可能会只输出到对话，跳过飞书写入

**逃逸路径**:
```
AI 合理化: "对话中已经输出了完整信息，用户可以手动复制"
AI 合理化: "飞书 MCP 只支持基础字段，不如直接输出"
```

**修复建议**:
明确双重输出要求：
```markdown
**⚠️ 双重输出要求（两者都必须执行）**：
1. ✅ 使用 Feishu MCP 写入基础字段到飞书表格
2. ✅ 在对话中输出完整报告（含痛点、互动策略等）
3. ❌ 禁止只输出到对话而跳过飞书写入
4. ❌ 禁止只写入飞书而不输出完整报告
```

---

#### 问题8: 商品需求分析可能被省略

**位置**: Line 268-273（策略A 执行流程）

**问题描述**:
- 说"分析每个选题的商品需求（强制步骤）"
- 但在输出示例中，商品需求分析只是简短的几句话
- AI 可能会认为这是可选的说明文字

**逃逸路径**:
```
AI 合理化: "商品需求分析只是辅助说明，不是必需的"
AI 合理化: "直接输出商品表格就够了"
```

**修复建议**:
在输出模板中强制要求：
```markdown
**输出格式（强制）**：
每个选题必须包含：
1. **商品需求分析**（必填，不得省略）
   - 核心需求：[从选题中提取]
   - 痛点：[用户在这个话题下的困扰]
   - 优先推荐：[品类优先级]
2. **商品建议表格**（必填，包含所有9个字段）
```

---

### 🟢 轻微问题（P2 - 可选修复）

#### 问题9: 红旗列表位置不当

**位置**: Line 517-534（红旗列表）

**问题描述**:
- 红旗列表放在 Step 4.5 之后
- AI 执行到 Step 4.5 时可能还没看到红旗
- 应该在 Step 4.5 开始前就看到

**修复建议**:
将红旗列表移到 Step 4.5 的开头，作为"执行前检查清单"。

---

#### 问题10: 输出模板缺少商品去重统计

**位置**: Line 582-662（输出模板）

**问题描述**:
- 输出模板中没有包含去重统计信息
- AI 可能会忘记输出重复率和品类分布

**修复建议**:
在输出模板中添加：
```markdown
## 📊 商品去重统计（v4.1）

| 指标 | 数值 | 状态 |
|------|------|------|
| 推荐商品总数 | 40个 | - |
| 新增商品数 | 35个 | ✅ |
| 重复商品数 | 5个 | ✅ |
| 名称重复率 | 12.5% | ✅ 正常 |
| 最高品类 | 基质类 | - |
| 品类集中度 | 28% | ✅ 均衡 |
```

---

## 📊 问题统计

| 严重程度 | 数量 | 必须修复 |
|---------|------|---------|
| 🔴 P0 严重 | 5个 | ✅ 是 |
| 🟡 P1 中等 | 3个 | ⚠️ 建议 |
| 🟢 P2 轻微 | 2个 | ❌ 可选 |
| **总计** | **10个** | - |

---

## 🎯 修复优先级建议

### 立即修复（P0）
1. ✅ 添加 Step 0（苏格拉底式提问）
2. ✅ 澄清"静默执行"的适用范围
3. ✅ 标记 v4.1 新字段为 MANDATORY
4. ✅ 添加账号阶段读取验证机制
5. ✅ 明确双层去重代码必须执行

### 建议修复（P1）
6. ⚠️ 添加 deep_research 执行顺序验证
7. ⚠️ 明确飞书写入的双重输出要求
8. ⚠️ 强制要求商品需求分析

### 可选修复（P2）
9. 📝 调整红旗列表位置
10. 📝 在输出模板中添加去重统计

---

## 🔄 下一步行动

### Option A: 立即修复所有 P0 问题
- 修改 SKILL.md
- 更新 OPTIMIZATION_LOG.md
- 提交 git commit

### Option B: 先修复 P0，再测试，再修复 P1
- 分批修复，逐步验证

### Option C: 创建修复计划，用户审核后执行
- 生成详细的修复方案
- 用户确认后批量修复

---

**建议**: 选择 Option A，立即修复所有 P0 问题，因为这些问题会导致 v4.1 的核心功能无法正常工作。

